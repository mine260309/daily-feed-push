<!DOCTYPE html>
<html>
<head>
<title>Subscriptions of daily-feed-push</title>
<script>
window.addEventListener("load", function () {
  // We need to access the form element
  var form = document.getElementById("email-form");

  // to takeover its submit event.
  form.addEventListener("submit", function (event) {
    event.preventDefault();
    subscribe();
  });
  
  var xmlhttp;
  function sendXHR(method, url, data, func)
  {
    xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange=func;
    xmlhttp.open(method, url);
    if (method == "POST") {
      xmlhttp.send(data);
    }
    else {
      xmlhttp.send();
    }
  }

  function subscribe()
  {
    // We bind the FormData object and the form element
    var formData  = new FormData(form);

    sendXHR("POST", "api/1/subscribe", formData, function() {
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {
        document.getElementById("result").innerHTML=xmlhttp.responseText;
        setTimeout(getSubscriptions, 0);
      }
      else {
        document.getElementById("result").innerHTML="Something went wrong:<br>"
        document.getElementById("result").innerHTML+=xmlhttp.responseText;
      }
    });
  }

  function getSubscriptions()
  {
    sendXHR("GET", "api/1/subscriptions", null, function() {
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {
        document.getElementById("current").innerHTML = "Current subscriptions:<br>"
        document.getElementById("current").innerHTML+=xmlhttp.responseText;
      }
      else {
        document.getElementById("current").innerHTML="Unable to get subscriptions:<br>"
        document.getElementById("current").innerHTML+=xmlhttp.responseText;
      }
    });
  }

  getSubscriptions();
});

</script>
</head>
<body>

<div id="content"><h2>Subscribe daily-feed-push with your email</h2></div>
<form id="email-form">
  <label for="myName">Email: </label>
  <input id="email" type="text" name="mail">
  <input type="submit" value="Subscribe"/>
</form>
<div id="result"></div>
<hr>
<div id="current">
Current subscriptions:<br>
</div>
</body>
</html>

